{% set portfolio = __SELF__.portfolio %}

    <div class="panel-heading">
      <h3 class="panel-title">{{ portfolio.description }}
        <button
            type="button"
            class="btn btn-xs btn-danger pull-right col-sm-offset-1"
            data-request="onDeletePortfolio"
            data-request-confirm="{{ 'piratmac.smmm::lang.messages.confirm_deletion'|trans }}">
            {{ 'Delete'|trans_label }}
        </button>

        <a href="{{ ''| page({action: 'update' }) }}" class="btn btn-xs btn-primary pull-right col-sm-offset-1">
          {{ 'manage'|trans_label }}
        </a>
      </h3>
    </div>
    <div class="row">
      <div class="col-md-2 col-md-offset-2">
        {{ 'opened_on'|trans_label }}:
        {{ portfolio.open_date }}
      </div>

      <div class="col-md-2">
        {{ 'closed_on'|trans_label }}:
        {{ portfolio.close_date }}
      </div>

      <div class="col-md-2">
        {{ 'broker'|trans_label }}:
        {{ portfolio.broker }}
      </div>

      <div class="col-md-2">
        {{ 'number'|trans_label }}:
        {{ portfolio.number }}
      </div>
    </div>
{#

{# Navigation tab headers #}
    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active">
        <a href="#contents" aria-controls="contents" role="tab" data-toggle="tab">
          {{ 'contents'|trans_label }}
        </a>
      </li>
      <li role="presentation">
        <a href="#movements" aria-controls="movements" role="tab" data-toggle="tab">
          {{ 'movements'|trans_label }}
        </a>
      </li>
      <li role="presentation">
        <a href="#createMovement" aria-controls="createMovement" role="tab" data-toggle="tab">
          {{ 'arbitration'|trans_label }}
        </a>
      </li>
    </ul>

{# Contents tab #}

    <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="contents">
        <table class="table-striped table">
          <tr>
            <th>
              {{ 'asset'|trans_label }}
            </th>
            <th class="text-right">
              {{ 'asset_count'|trans_label }}
            </th>
            <th class="text-right">
              {{ 'average_buy_price'|trans_label }}
            </th>
            <th class="text-right">
              {{ 'total_buy_price'|trans_label }}
            </th>
          </tr>




    {# Stocks #}
          {% for heldAsset in portfolio.contents if heldAsset.type == 'stock' and heldAsset.pivot.asset_count != 0 %}
          {% if loop.first %}
          <tr>
            <th colspan="6">
              {{ 'stocks'|trans_label }}
            </th>
          </tr>
          {% endif %}
          <tr>
            <td>
              <a href="{{ heldAsset.url_view }}">
                {{ heldAsset.title }} ({{ heldAsset.id }})
              </a>
            </td>
            <td class="text-right">
              {{ heldAsset.pivot.asset_count|number_format_count }}
            </td>
            <td class="text-right">
              {{ heldAsset.pivot.average_price_tag|number_format_price }}
            </td>
            <td class="text-right">
              {{ heldAsset.pivot.totalBuyPrice|number_format_amount }}
            </td>
          </tr>

          {% endfor %}
          {% if portfolio.balance.stock != 0 %}
          <tr>
            <th colspan="3" class="text-right">
              {{ 'stocks'|trans_label }}
            </th>
            <th class="text-right">
              {{ portfolio.balance.stock|number_format_amount }}
            </th>
          </tr>
          {% endif %}



    {# Bonds #}
          {% for heldAsset in portfolio.contents if heldAsset.type == 'bond' and heldAsset.pivot.asset_count != 0 %}
          {% if loop.first %}
          <tr>
            <th colspan="6">
              {{ 'bonds'|trans_label }}
            </th>
          </tr>
          {% endif %}
          <tr>
            <td>
              <a href="{{ heldAsset.url_view }}">
                {{ heldAsset.title }} ({{ heldAsset.id }})
              </a>
            </td>
            <td class="text-right">
              {{ heldAsset.pivot.asset_count|number_format_count }}
            </td>
            <td class="text-right">
              {{ heldAsset.pivot.average_price_tag|number_format_price }}
            </td>
            <td class="text-right">
              {{ heldAsset.pivot.totalBuyPrice|number_format_amount }}
            </td>
          </tr>

          {% endfor %}
          {% if portfolio.balance.bond != 0 %}
          <tr>
            <th colspan="3" class="text-right">
              {{ 'bonds'|trans_label }}
            </th>
            <th class="text-right">
              {{ portfolio.balance.bond|number_format_amount }}
            </th>
          </tr>
          {% endif %}


    {# Mixed #}
          {% for heldAsset in portfolio.contents if heldAsset.type == 'mixed' and heldAsset.pivot.asset_count != 0 %}
          {% if loop.first %}
          <tr>
            <th colspan="6">
              {{ 'mixed'|trans_label }}
            </th>
          </tr>
          {% endif %}
          <tr>
            <td>
              <a href="{{ heldAsset.url_view }}">
                {{ heldAsset.title }} ({{ heldAsset.id }})
              </a>
            </td>
            <td class="text-right">
              {{ heldAsset.pivot.asset_count|number_format_count }}
            </td>
            <td class="text-right">
              {{ heldAsset.pivot.average_price_tag|number_format_price }}
            </td>
            <td class="text-right">
              {{ heldAsset.pivot.totalBuyPrice|number_format_amount }}
            </td>
          </tr>

          {% endfor %}
          {% if portfolio.balance.mixed != 0 %}
          <tr>
            <th colspan="3" class="text-right">
              {{ 'mixed'|trans_label }}
            </th>
            <th class="text-right">
              {{ portfolio.balance.mixed|number_format_amount }}
            </th>
          </tr>
          {% endif %}


        <tr>
          <th colspan="3" class="text-right">
            {{ 'cash'|trans_label }}
          </th>
          <th class="text-right">
            {{ portfolio.balance.cash|number_format_amount }}
          </th>
        </tr>
        <tr>
          <th colspan="3" class="text-right">
            {{ 'total'|trans_label }}
          </th>
          <th class="text-right">
            {{ portfolio.balance.total|number_format_amount }}
          </th>
        </tr>
        </table>
      </div>


{# Movements tab #}

      <div role="tabpanel" class="tab-pane" id="movements">
        {% if portfolio.movements.count == 0 %}
        <table class="table-striped table">
          <tr>
            <th>
              {{ 'piratmac.smmm::lang.messages.no_movement'|trans }}
            </th>
          </tr>
        </table>
        {% else %}
        {% for movement in portfolio.movements %}
        {% if loop.first %}
        <table class="table-striped table">
          <tr>
            <th colspan="8">
              {{ 'movements'|trans_label }}
            </th>
          </tr>
          <tr>
            <th>
              {{ 'asset'|trans_label }}
            </th>
            <th>
              {{ 'type'|trans_label }}
            </th>
            <th>
              {{ 'date'|trans_label }}
            </th>
            <th class="text-right">
              {{ 'asset_count'|trans_label }}
            </th>
            <th class="text-right">
              {{ 'unit_value'|trans_label }}
            </th>
            <th class="text-right">
              {{ 'fee'|trans_label }}
            </th>
            <th class="text-right">
              {{ 'cash_balance'|trans_label }}
            </th>
            <th class="text-right">
              {{ 'delete'|trans_label }}
            </th>
          </tr>
        {% endif %}

          <tr>
            <td>
              {% if movement.asset.title == '' %}
              {{ 'piratmac.smmm::lang.dropdowns.asset.type.cash'|trans }}
              {% elseif movement.asset.url_view == '' %}
                {{ movement.asset.title }}
              {% else %}
              <a href="{{ movement.asset.url_view }}">
                {{ movement.asset.title }}
              </a>
              {% endif %}
            </td>
            <td>
              {{ ('piratmac.smmm::lang.dropdowns.movement.type.' ~ movement.type) |trans  }}
            </td>
            <td>
              {{ movement.date }}
            </td>
            <td class="text-right">
              {{ movement.asset_count|hide_if_zero }}
            </td>
            <td class="text-right">
              {{ movement.unit_value|hide_if_zero }}
            </td>
            <td class="text-right">
              {{ movement.fee|hide_if_zero }}
            </td>
            <td class="text-right">
              {{ movement.cashBalance|number_format_amount }}
            </td>
            <td class="text-right">
              <button
                type="button"
                class="btn btn-xs pull-right col-sm-offset-1"
                style="background:none"
                data-request="onDeleteMovement"
                data-request-data="movement_id: {{ movement.id }}"
                data-request-confirm="{{ 'piratmac.smmm::lang.messages.confirm_deletion'|trans }}">
                  <img src="{{ (__SELF__.imageFolder ~ '/denied.png')|app}}" alt="{{ 'delete'|trans_label }}" class="image_circle" width="25px" height="25x" />
              </button>
            </td>
          </tr>
        {% if loop.last and portfolio.movements.fragment('movements').render|raw|length >0  %}
          <tr>
            <td colspan="8" class="text-center">
              {{ portfolio.movements.fragment('movements').render|raw }}
            </td>
          </tr>
        {% endif %}
        {% if loop.last %}
        </table>
        {% endif %}
        {% endfor %}
        {% endif %}
      </div>


{# New movement tab #}
      <div role="tabpanel" class="tab-pane" id="createMovement">
        {{ form_open() }}
        {{ formPortfolioMovement.formRender()|raw }}

        <div class="form-buttons">
          <div class="loading-indicator-container">
              <button
                  type="submit"
                  data-request="onCreateMovement"
                  class="btn btn-primary">
                  {{ 'Save'|trans_label }}
              </button>
              <a href="{{ __SELF__.portfolioListPage |page }}" class="text-danger">
                {{'Cancel'|trans_label}}
              </a>
          </div>
        </div>
        {{ form_close() }}
      </div>





{# Closing div for tabs #}

    </div>